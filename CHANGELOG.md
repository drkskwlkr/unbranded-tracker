# Журнал на промените
Този файл отразява всички промени и подобрения по UT. За удобство на четящите, най-новите промени ще бъдат публикувани най-отгоре.

## 2021-12-23
### Нова функционалност
Няма.

### Промени
Функцията за докладване на успешна доставка и зареждането на бутона за искане на препоръка вече работи за всички поддържани куриерски услуги.

![image](https://user-images.githubusercontent.com/6951698/147168684-f173a0b3-3b3d-4207-99c0-7160d31aad1a.png)

Възможно е тази функция да не работи правилно или да спре да работи при услугите, които се ползват чрез scraping на статус страница, вместо чрез API. За момента това са A1 Post и Лео Експрес. При тях се прави прехващане на текст; ако услугата започне да подава различен текст, кодът ще престане да разпознава статуса "доставена". CVC е "на кантар" — при тях теглим информацията директно чрез GET заявка, но опознаваме статусите по текстовото им описание, понеже информацията, която връща заявката, не включва поле за статус.

### Как да инсталирате
Обновете `track.php`


## 2021-12-19
### Нова функционалност
Няма.

### Промени
Хронологията на доставките за Спиди е разхубавена. Вече при доставка до офис се показва карта на офиса с работното му време, а при доставка до адрес се посочва и прозорецът за разнос, генериран от предикт системата. При получаване на пратката (независимо дали от офис или на адрес) картата/предикт съобщението се скриват и на тяхно място излиза зелено поле с покана за оставяне на отзив.

### Отстранени бъгове
Няма.

### Как да инсталирате
1. Свалете `feedback.php`
2. Обновете `access.inc.php, track.php и style.css`



## 2021-12-16
### Нова функционалност
Няма.

### Промени
Обновяване на стиловете за фиксиране на заглавния блок при скролиране надолу.
![image](https://user-images.githubusercontent.com/6951698/146439991-35a84318-8f58-4634-86ee-530df5657a0b.png)

### Отстранени бъгове
Няма.

### Как да инсталирате
Обновете ``style.css``



## 2021-12-14
### Нова функционалност
Няма.

### Промени
Съдържанието на .htaccess е допълнено с още едно условие, което позволява паралелна употреба на двата синтаксиса (track.example.com/?p=123456789 и track.example.com/123456789).

### Отстранени бъгове
Няма.

### Как да инсталирате
Обновете [съдържанието на .htaccess файла](https://github.com/drkskwlkr/unbranded-tracker/blob/main/.htaccess.DISABLED).

**Важно:** Модификацията работи и се поддържа **само** ако сте инсталирали тракера в самостоятелен под-домейн. Тествайте **незабавно** поведението на скрипта и ако получавате грешка HTTP 500 или друго нещо не работи, изтрийте .htaccess за да върнете предишното състояние на нещата.



## 2021-12-13
### Нова функционалност
- Добавена е възможност за алтернативно формиране на адреса за проследяване чрез .htaccess пренаписване. Нормалната заявка изглежда така: track.example.com/?p=123456789, а новата би могла да изглежда ето така: track.example.com/123456789. Спестяват се 3 символа (важно, ако комуникирате тази информация чрез SMS) и целият адрес придобива отчетливо по-прегледен вид.

Това решение има съществени ограничения спрямо оригиналното поведение на скрипта. Прочетете внимателно документацията.

### Промени
Няма.

### Отстранени бъгове
Няма.

### Как да инсталирате
Модификацията работи и се поддържа **само** ако сте инсталирали тракера в самостоятелен под-домейн. Нужно е да свалите файла `.htaccess.DISABLED` и да го преименувате на `.htaccess`. Тествайте **незабавно** поведението на скрипта и ако получавате грешка HTTP 500 или друго нещо не работи, изтрийте .htaccess



## 2021-12-13
### Нова функционалност
- Добавена е поддръжка за проследяване на товарителници на [CVC](https://cvc.bg). За да ги обработва правилно скриптът, вкарвайте ги без водещия хеш символ, но не изпускайте нулите отпред.

### Промени
Съдържанието на файла `config.inc.php` е разделено на две. В досегашния `config.inc.php` остават настройките, които са различни за индивидуалните потребители (API достъп до Speedy, настройки за URL адреси на сайта и т.н.). Идеята е този файл да се актуализира изключително рядко и да не се налага да го замествате след всяка промяна с нова версия от repo-то и да попълвате вашите настройки вътре.

Останалите настройки от `config.inc.php` се преместват в новосъздадения `access.inc.php`. Той ще съдържа настройки, свързани с поведението на отделните куриерски услуги и ще се променя в три случая: (1) при добавянето на нов куриер, (2) при някаква промяна в начина за извличане на информацията от съществуващ куриер и (3) при някаква промяна в начина на формиране на товарителниците на съществуващ куриер.

### Отстранени бъгове
Няма.

### Как да инсталирате
Нужно е да свалите следните файлове:
```
access.inc.php
track.php
style.css
```
Също така трябва или (1) да свалите отново `config.inc.php` и да си пренесете данните от частта `# Administrative` и `# Speedy User Details` в новия файл, или (2) да редактирате съществуващия `config.inc.php` и да изтриете всичко след ред 11 (`define ('SPEEDY_PASS', "") ;`).



## 2021-12-12
### Нова функционалност
- Добавена е поддръжка за проследяване на товарителници на [Лео Експрес](https://leoexpres.bg).

Също както с тракера за A1, информацията от Лео Експрес е добива чрез сваляне от публично достъпна web страница. Този метод има няколко важни недостатъка: (1) може да бъде бавен; (2) може да бъде блокиран спрямо източника и (3) може да спре да работи във всеки един момент, ако се промени дори минимално HTML кодът на страницата. YMMV (Your Mileage May Vary).

За разлика от тракера на A1 обаче, тракингът на Лео Експрес може да се извършва и през API, което е далеч по-надеждно решение. За целта обаче е необходимо потребителско име и парола за достъп, с каквито не разполагам.

### Промени
Няма.

### Отстранени бъгове
Няма.

### Как да инсталирате
Нужно е да копирате отново три от четирите файла (`config.inc.php`, `track.php` и `style.css`). Като ги презаписвате, най-напред си запазете настройките от предишната версия на `config.inc.php` в частта `# Administrative` и `# Speedy User Details` и след това ги пренесете в новия файл.



## 2021-12-11
### Нова функционалност
- Добавена е поддръжка за проследяване на товарителници на [A1 Post](https://a1post.bg). Тъй като A1 Post използват Deutsche Post, на практика всяка товарителница във UPU формат (XX123456789YY) със страна на произход Германия ще бъде опознавана като товарителница на A1 Post, което може да е проблем за онези от вас, които изпращат пратки по пощата от Германия, но не използват услугите на A1 Post. Сигнализирайте, ако това е така, за да помислим какво може да се направи.
- Следствие от горното, става много лесно да се добави поддръжка за друг вид пощенски пратки, например от Български пощи (XX123456789BG) или други изпращачи, които издават номера по същата схема. Ако ви е необходима такава функционалност, сигнализирайте. Ще ми бъдат нужни няколко валидни номера за проследяване за тестване.

### Промени
- Реализиран е нов механизъм за разпознаване на формата на товарителниците чрез RegEx. Това ще улесни добавянето на допълнителни формати за проследяване в бъдещето.
- Добавен е незадължителен параметър за превключване на езика на UT между български и английски. За да го използвате, трябва да добавите към края на заявката &lang=bg (български) или &lang=en (английски). Ако се изпусне този параметър, страницата ще извлече и покаже статуса на проследяване на езика, който сте задали по подразбиране чрез параметъра `LANGUAGE_DEFAULT` в `config.inc.php`. **Забележка** За момента тази функция засяга само съобщенията от хронологията на самата доставка. Двете съобщения в главата на страницата засеега остават на български. Ако много държите и те да са на английски, редактирайте ги в `track.php`. Многоезичността на модула не ми е приоритет и за собствени цели няма да се занимавам повече с нея.

### Отстранени бъгове
Няма.

### Как да инсталирате
Нужно е да копирате отново три от четирите файла (`config.inc.php`, `track.php` и `style.css`). Като ги презаписвате, най-напред си запазете настройките от предишната версия на `config.inc.php` в частта `# Administrative` и `# Speedy User Details` и след това ги пренесете в новия файл.
